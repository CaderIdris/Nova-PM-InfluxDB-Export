Nova PM Sensor Export
---

**Stable Release**

**Joe Hayward (j.d.hayward@surrey.ac.uk)**

**COPYRIGHT 2021, Joe Hayward**

**GNU General Public License v3.0**

This program was designed, tested and run on Ubuntu 21.04. It will very likely run on other Linux distributions though it has not been tested. This program has not been tested on Windows or MacOS.

This program is designed to read csv files generated by Nova PM sensors that were downloaded from a website, in collaboration with external partners. The data is not publicly available currently to our knowledge.

---

## Table of Contents

1. [Standard Operating Procedure](#standard-operating-procedure)
2. [Settings](#settings)
3. [Setup](#setup)
4. [API](#api)
5. [Components](#components)

---

## Standard Operating Procedure

### Terminal

This program is initialised via the terminal:
- `bash run.sh` or `./run.sh` 
Once the program is initialised, the opening blurb will show. If Debug Stats is set to true, it will display all information contained in config.json

---

## Settings

### config.json

config.json contains several configurable parameters for the program:
- `"File Path"`: Absolute path to the data, do not end with a /
- `"Debug Stats"`: Boolean value (`true/false`). Will output config.json to terminal if true
- `"Influx Bucket"`: Name of InfluxDB v2.0 bucket to export measurements to
- `"Influx IP"`: IP address of InfluxDB v2.0 instance ("localhost" if hosted on same machine)
- `"Influx Port"`: Port of InfluxDB v2.0 instance (Usually 8086)
- `"Influx Token"`: User token to authorise communications with database
- `"Influx Organisation"`: Organisation the token falls under

---

## Setup

### Step 1: Download program from Github

Navigate to the directory you want to store the program in and run `git clone https://github.com/Joppleganger/Nova-PM-Sensor-Export.git`

### Step 2: Run setup script

`bash setup.sh` or `./setup.sh` runs the setup script, installing the virtual environment needed to run the program

---

## API

This info can currently be found in documentation within python files, will be updated here later

---

## Example data

The following is an example of the two csv file formats.

### Old format

|car_no|sn|lat|lng|pm10|pm2_5|speed|time|
|---|---|---|---|---|---|---|---|
|C008-0001|C008-0001|*N/A*|*N/A*|20.9|16.0|0.0|"2020-01-10 09:30:00.711000+08:00"
|C008-0003|C008-0003|*N/A*|*N/A*|21.1|16.6|0.0|"2020-01-10 09:30:02.961000+08:00"

Headings:
- **car_no**: Car number (The sensors were referred to as cars), acts as an identifier for the sensor. Files contained multiple "cars"
- **sn**: Serial number of sensor, functionally identical to **car_no**
- **lat**: Latitude coordinate, redacted here
- **lng**: Longitude coordinate, redacted here
- **pm10**: PM<sub>10</sub> measurement in μg m<sup>-3</sup>
- **pm2_5**: PM<sub>2.5</sub> measurement in μg m<sup>-3</sup>
- **speed**: Speed sensor is moving in km/h
- **time**: Timestamp in `YYYY-MM-DD HH:MM:SS.ffffff+TZ` format, unless the measurement was made exactly on the second in which case it's `YYYY-MM-DD HH:MM:SS+TZ`. Timezone was set to China despite sensor being located in London, so -8 hour correction is made in the program 

### New format

|time|sn|pm25|pm10|
|---|---|---|---|
|2020-04-17T20:39:25.182+08:00|C008-0001|8.5|25.2|
|2020-04-17T20:39:28.151+08:00|C008-0001|8|20.3|

Headings:
- **sn**: Serial number of sensor, sensors now split in to different files
- **pm10**: PM<sub>10</sub> measurement in μg m<sup>-3</sup>
- **pm2_5**: PM<sub>2.5</sub> measurement in μg m<sup>-3</sup>
- **time**: Timestamp in `YYYY-MM-DDTHH:MM:SS.ffffff+TZ` format, unless the measurement was made exactly on the second in which case it's `YYYY-MM-DDTHH:MM:SS+TZ`. Timezone was set to China despite sensor being located in London, so -8 hour correction is made in the program 
